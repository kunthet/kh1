const firebaseConfig={apiKey:"AIzaSyB0JYYZORal3fiOo12xoTZk5GSa2FFjGTs",authDomain:"onekh-voting.firebaseapp.com",databaseURL:"https://onekh-voting-default-rtdb.asia-southeast1.firebasedatabase.app",projectId:"onekh-voting",storageBucket:"onekh-voting.firebasestorage.app",messagingSenderId:"1058196661068",appId:"1:1058196661068:web:e36447a0be86e0734025e9"};class VoteWidget{constructor(){this.voted="true"===localStorage.getItem("onekh_voted"),this.visited="true"===localStorage.getItem("onekh_visited"),this.voteCount=0,this.visitorCount=0,this.db=null,this.isLoading=!0}async init(){try{await this.loadFirebase(),firebase.apps.length||firebase.initializeApp(firebaseConfig),this.db=firebase.database(),this.visited||await this.trackVisitor(),this.setupListeners(),this.isLoading=!1,this.updateUI()}catch(t){this.showError()}}async loadFirebase(){"undefined"==typeof firebase&&(await this.loadScript("https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"),await this.loadScript("https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"))}loadScript(t){return new Promise(((e,i)=>{const o=document.createElement("script");o.src=t,o.async=!0,o.onload=e,o.onerror=i,document.head.appendChild(o)}))}setupListeners(){this.db.ref("votes/total").on("value",(t=>{this.voteCount=t.val()||0,this.updateUI()}));this.db.ref("visitors/total").on("value",(t=>{this.visitorCount=t.val()||0,this.updateUI()}))}async trackVisitor(){try{const t=this.db.ref("visitors/total");await t.transaction((t=>(t||0)+1)),this.visited=!0,localStorage.setItem("onekh_visited","true")}catch(t){}}async handleVote(){if(!this.voted&&!this.isLoading)try{const t=this.db.ref("votes/total");await t.transaction((t=>(t||0)+1)),this.voted=!0,localStorage.setItem("onekh_voted","true"),this.updateUI()}catch(t){alert("Failed to submit vote. Please try again.")}}updateUI(){const t=document.getElementById("vote-widget");if(!t)return;const e=t.querySelector(".vote-btn"),i=t.querySelector(".vote-count"),o=t.querySelector(".vote-text"),a=t.querySelector(".visitor-count");i&&(i.textContent=this.formatNumber(this.voteCount)),a&&(a.textContent=this.formatNumber(this.visitorCount)),e&&(this.isLoading?(e.disabled=!0,e.innerHTML="â³"):this.voted?(e.disabled=!0,e.innerHTML="âœ“",e.classList.add("voted")):(e.disabled=!1,e.innerHTML="ðŸ‘")),o&&(this.voted?o.textContent=t.getAttribute("data-voted-text")||"Thanks for voting!":o.textContent=t.getAttribute("data-vote-text")||"Vote for this project")}formatNumber(t){return t>=1e6?(t/1e6).toFixed(1)+"M":t>=1e3?(t/1e3).toFixed(1)+"K":t.toString()}showError(){const t=document.getElementById("vote-widget");t&&(t.innerHTML='<p style="color: #888; font-size: 0.9rem;">Widget unavailable</p>')}}function initWidget(){const t=new VoteWidget;t.init();const e=document.querySelector("#vote-widget .vote-btn");e&&e.addEventListener("click",(()=>t.handleVote()))}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initWidget):initWidget();